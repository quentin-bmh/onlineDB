Login/Register par Magic Password (OTP email)
1. Inscription (Register)
Lâ€™utilisateur entre son adresse email dans un formulaire â€œCrÃ©er un compteâ€.
Le serveur vÃ©rifie si lâ€™email existe dÃ©jÃ  en base :
Sâ€™il existe â†’ on propose la connexion.
Sâ€™il nâ€™existe pas â†’ on crÃ©e un compte avec email, created_at et Ã©ventuellement un username ou autres mÃ©tadonnÃ©es.
Le serveur gÃ©nÃ¨re un code OTP Ã  6 chiffres (alÃ©atoire).
Le code est hashÃ© (bcrypt/SHA256) puis stockÃ© en base avec :
email
code_hash
expires_at (ex. +5 minutes)
used = false.

Le serveur envoie un email contenant le code OTP.
Lâ€™utilisateur saisit le code reÃ§u dans lâ€™interface.
Le serveur compare le code fourni (aprÃ¨s hash) avec celui en DB.
Si correct et valide â†’ inscription validÃ©e et JWT/session gÃ©nÃ©rÃ© â†’ lâ€™utilisateur est connectÃ©.

2. Connexion (Login)
Lâ€™utilisateur entre son email dans le formulaire â€œSe connecterâ€.
Le serveur gÃ©nÃ¨re un nouveau code OTP Ã  6 chiffres.
Le code est stockÃ© en DB (hash + expiration + used=false).
Le serveur envoie le code par email Ã  lâ€™utilisateur.
Lâ€™utilisateur saisit le code dans le champ prÃ©vu.
Le serveur vÃ©rifie :
Que lâ€™OTP existe pour cet email,
Quâ€™il nâ€™a pas expirÃ©,
Quâ€™il nâ€™a pas dÃ©jÃ  Ã©tÃ© utilisÃ©.
Si tout est OK â†’ le serveur :
Marque lâ€™OTP comme used=true,
GÃ©nÃ¨re un JWT dâ€™authentification (access + refresh) ou une session serveur,
Renvoie ce token au client.
Lâ€™utilisateur est maintenant connectÃ©.

3. SÃ©curitÃ©
ğŸ”’ DurÃ©e de vie courte â†’ OTP valable seulement 2 Ã  5 minutes.
ğŸ”’ Usage unique â†’ dÃ¨s quâ€™il est validÃ©, il est marquÃ© comme â€œutilisÃ©â€.
ğŸ”’ Rate limiting â†’ limiter lâ€™envoi de codes par email (ex. max 3/minute par IP/email).
ğŸ”’ Hash en DB â†’ ne jamais stocker le code en clair.
ğŸ”’ Expiration automatique â†’ nettoyage rÃ©gulier des OTP expirÃ©s.

4. ExpÃ©rience utilisateur
Facile â†’ pas besoin de se souvenir dâ€™un mot de passe.
Rapide â†’ il suffit de vÃ©rifier sa boÃ®te mail.
Flexible â†’ peut Ãªtre combinÃ© avec un refresh token pour Ã©viter de redemander un code trop souvent.
Optionnel â†’ tu peux aussi proposer un fallback â€œlogin classiqueâ€ (email + mot de passe) pour les utilisateurs qui prÃ©fÃ¨rent.

5. SchÃ©ma simplifiÃ© du flux
EntrÃ©e email
Envoi OTP par email
Saisie du code par lâ€™utilisateur
VÃ©rification serveur
JWT/session gÃ©nÃ©rÃ©e
Utilisateur connectÃ©  