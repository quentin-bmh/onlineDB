Login/Register par Magic Password (OTP email)
1. Inscription (Register)
L’utilisateur entre son adresse email dans un formulaire “Créer un compte”.
Le serveur vérifie si l’email existe déjà en base :
S’il existe → on propose la connexion.
S’il n’existe pas → on crée un compte avec email, created_at et éventuellement un username ou autres métadonnées.
Le serveur génère un code OTP à 6 chiffres (aléatoire).
Le code est hashé (bcrypt/SHA256) puis stocké en base avec :
email
code_hash
expires_at (ex. +5 minutes)
used = false.

Le serveur envoie un email contenant le code OTP.
L’utilisateur saisit le code reçu dans l’interface.
Le serveur compare le code fourni (après hash) avec celui en DB.
Si correct et valide → inscription validée et JWT/session généré → l’utilisateur est connecté.

2. Connexion (Login)
L’utilisateur entre son email dans le formulaire “Se connecter”.
Le serveur génère un nouveau code OTP à 6 chiffres.
Le code est stocké en DB (hash + expiration + used=false).
Le serveur envoie le code par email à l’utilisateur.
L’utilisateur saisit le code dans le champ prévu.
Le serveur vérifie :
Que l’OTP existe pour cet email,
Qu’il n’a pas expiré,
Qu’il n’a pas déjà été utilisé.
Si tout est OK → le serveur :
Marque l’OTP comme used=true,
Génère un JWT d’authentification (access + refresh) ou une session serveur,
Renvoie ce token au client.
L’utilisateur est maintenant connecté.

3. Sécurité
🔒 Durée de vie courte → OTP valable seulement 2 à 5 minutes.
🔒 Usage unique → dès qu’il est validé, il est marqué comme “utilisé”.
🔒 Rate limiting → limiter l’envoi de codes par email (ex. max 3/minute par IP/email).
🔒 Hash en DB → ne jamais stocker le code en clair.
🔒 Expiration automatique → nettoyage régulier des OTP expirés.

4. Expérience utilisateur
Facile → pas besoin de se souvenir d’un mot de passe.
Rapide → il suffit de vérifier sa boîte mail.
Flexible → peut être combiné avec un refresh token pour éviter de redemander un code trop souvent.
Optionnel → tu peux aussi proposer un fallback “login classique” (email + mot de passe) pour les utilisateurs qui préfèrent.

5. Schéma simplifié du flux
Entrée email
Envoi OTP par email
Saisie du code par l’utilisateur
Vérification serveur
JWT/session générée
Utilisateur connecté  